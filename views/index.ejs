<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/training.css">
    <link rel="stylesheet" href="/css/admin.css"> 
    <link rel="stylesheet" href="/css/gym-pet.css"> 
    <title>PIXEL HERO - TR·∫†M CH·ªà HUY</title>
</head>
<body style="background-image: url('<%= bg %>'); background-size: cover; background-position: center; background-attachment: fixed;">
    
    <div id="training-overlay" style="display:none;">
        <h2 style="color: #fff; font-size: 2rem;">NH·∫§N PH√çM!</h2>
        <div id="target-key">W</div>
        <div class="timer-container"><div id="timer-bar"></div></div>
    </div>

    <div class="admin-bg-tool" id="admin-panel" style="display: none;">
        <button class="btn-admin" onclick="document.getElementById('bg-input').click()">üõ† ƒê·ªîI N·ªÄN</button>
        <input type="file" id="bg-input" hidden accept="image/*" onchange="uploadBackground(this)">
    </div>

    <div class="dashboard-container">
        <div class="side-panel">
            <div class="pixel-panel">
                <h2 class="panel-title">üìä TR·∫†NG TH√ÅI</h2>
                
                <div class="stat-item">
                    <span class="stat-label-fixed">M√ÅU</span>
                    <span id="hp-val" class="stat-value color-hp"><%= player.displayHp %></span>
                    <% if (player.pet && player.pet.hpBuff > 0) { %>
                        <small class="pet-buff-tag-fixed">+<%= player.pet.hpBuff %></small>
                    <% } %>
                </div>
                
                <div class="stat-item">
                    <span class="stat-label-fixed">C√îNG</span>
                    <span id="atk-val" class="stat-value color-atk"><%= player.displayAtk %></span>
                    <% if (player.pet && player.pet.atkBuff > 0) { %>
                        <small class="pet-buff-tag-fixed">+<%= player.pet.atkBuff %></small>
                    <% } %>
                </div>
                
                <div class="stat-item">
                    <span class="stat-label-fixed">T·ªêC</span>
                    <span id="spd-val" class="stat-value color-spd"><%= player.displaySpd %></span>
                    <% if (player.pet && player.pet.spdBuff > 0) { %>
                        <small class="pet-buff-tag-fixed">+<%= player.pet.spdBuff %></small>
                    <% } %>
                </div>
            </div>

            <div class="pixel-panel">
                <a href="/shop" class="btn-pixel" style="display:block; text-decoration:none; background: #ff9800; color:#000; text-align:center; margin-bottom: 10px;">ü•ö C·ª¨A H√ÄNG PET</a>
                <a href="/leaderboard" class="btn-pixel" style="display:block; text-decoration:none; background: var(--pixel-yellow); color:#000; text-align:center;">üèÜ B·∫¢NG X·∫æP H·∫†NG</a>
            </div>
        </div>

        <div class="center-panel">
            <div class="name-editor">
                <input type="text" id="player-name" value="<%= player.name %>" maxlength="12">
                <button onclick="saveName()" class="btn-pixel" style="width: auto;">L∆ØU</button>
            </div>

            <div class="avatar-hero-section">
                <div id="avatar-display" onclick="document.getElementById('file-input').click()" style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
                    <% if (player.avatar) { %>
                        <img src="<%= player.avatar %>" class="hero-img">
                    <% } else { %> 
                        <span style="font-size: 5rem;">üõ°Ô∏è</span> 
                    <% } %>
                </div>
                
                <div class="pet-floating-box" onclick="window.location.href='/pet-profile'" title="<%= player.pet && player.pet.name ? player.pet.name : 'Xem H·ªì S∆° Pet' %>">
    <% if (player.pet && player.pet.avatar) { %>
        <img src="<%= player.pet.avatar %>" class="pet-mini-img">
        
    <% } else { %> 
        <div class="pet-empty" onclick="event.stopPropagation(); window.location.href='/shop'">üêæ</div>
    <% } %>
</div>

                <div class="edit-label">CLICK AVATAR ƒê·ªÇ S·ª¨A</div>
            </div>

            <input type="file" id="file-input" hidden accept="image/*" onchange="uploadAvatar(this)">
            <a href="/battle" class="btn-launch">V√ÄO ƒê·∫§U TR∆Ø·ªúNG üî•</a>
        </div>

        <div class="side-panel">
            <div class="pixel-panel">
                <h2 class="panel-title">üèãÔ∏è HU·∫§N LUY·ªÜN</h2>
                <button onclick="startTraining('hp')" class="btn-pixel">LUY·ªÜN TH·ªÇ ‚ù§Ô∏è</button>
                <button onclick="startTraining('atk')" class="btn-pixel">LUY·ªÜN C√îNG ‚öîÔ∏è</button>
                <button onclick="startTraining('spd')" class="btn-pixel">LUY·ªÜN T·ªêC ‚ö°</button>
            </div>

            <div class="pixel-panel gym-panel">
                <h2 class="panel-title">üè™ GYM AFK</h2>
                <% if (player.isTrainingAFK) { %>
                    <p class="blink-text">üèãÔ∏è ƒêang t·∫≠p <%= player.trainingStat.toUpperCase() %>...</p>
                    <button onclick="toggleGym()" class="btn-pixel" style="background: #f44336;">R·ªúI PH√íNG</button>
                <% } else { %>
                    <select id="afk-stat" class="btn-pixel afk-select">
                        <option value="hp">T·∫¨P HP (M√ÅU)</option>
                        <option value="atk">T·∫¨P ATK (C√îNG)</option>
                        <option value="spd">T·∫¨P SPD (T·ªêC)</option>
                    </select>
                    <button onclick="toggleGym()" class="btn-pixel" style="background: #4caf50;">V√ÄO T·∫¨P AFK</button>
                <% } %>
            </div>
            
            <div class="pixel-panel footer-credit">
                DESIGN BY: <span style="color: var(--pixel-yellow);">T√ö ƒê·∫∏P TRAI</span>
            </div>
        </div>
    </div>

    <script src="/js/game-logic.js"></script>
</body>
</html>